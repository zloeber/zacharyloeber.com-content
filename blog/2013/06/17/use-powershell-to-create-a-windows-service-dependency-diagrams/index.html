<!doctype html>
<html class="no-js" lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="author" content="Zachary Loeber">
        <meta name="description" content="Zachary Loeber&#39;s Personal Site">
        <meta name="keywords" content="blog,personal,devops,infrastructure,code">
        <meta name="generator" content="Hugo 0.53" />
        <title> Use Powershell to Create a Windows Service Dependency Diagrams | Zachary Loeber</title>
        <meta name="description" content="Use Powershell to Create a Windows Service Dependency Diagrams - Zachary Loeber&#39;s Personal Site">
        <meta itemprop="name" content="Use Powershell to Create a Windows Service Dependency Diagrams">
        <meta itemprop="description" content="Use Powershell to Create a Windows Service Dependency Diagrams - Zachary Loeber&#39;s Personal Site">
        <meta property="og:title" content="Use Powershell to Create a Windows Service Dependency Diagrams">
        <meta property="og:description" content="Use Powershell to Create a Windows Service Dependency Diagrams - Zachary Loeber&#39;s Personal Site">
        <meta property="og:image" content="https://www.gravatar.com/avatar/48fc6231ab6cad25f101a82e5932d9dd?size=200">
        <meta property="og:url" content="https://zacharyloeber.com/blog/2013/06/17/use-powershell-to-create-a-windows-service-dependency-diagrams/">
        <meta property="og:site_name" content="Zachary Loeber">
        <meta property="og:type" content="article">
        <link rel="icon" type="image/png" href="https://zacharyloeber.com/favicon-32x32.png" sizes="32x32">
        <link rel="icon" type="image/png" href="https://zacharyloeber.com/favicon-16x16.png" sizes="16x16">

	

        
        
        
        
        <link rel="stylesheet" href="https://zacharyloeber.com/sass/combined.min.5f50be91a665634f9dfed5900bc388393fc430e3369d58e73b8375457a6df832.css">

        

        
            
        
    </head>
    <body class="bilberry-hugo-theme">
        
<nav class="permanentTopNav">

    <div class="container">
        <ul class="topnav">
            
                
                    <li><a href="https://zacharyloeber.com/" target="">Home</a></li>
                
            
                
                    <li><a href="https://zacharyloeber.com/page/about/">About</a></li>
                
            
                
                    <li><a href="https://zacharyloeber.com/page/about-me/">About Me</a></li>
                
            
        </ul>

        
    </div>
</nav>


        <header>
    <div class="container">
        <div class="logo">
            <a href="https://zacharyloeber.com/" class="logo">
                
                    <img src="https://www.gravatar.com/avatar/48fc6231ab6cad25f101a82e5932d9dd?d=mm&size=200" alt="">
                

                <span class="overlay"><i class="fa fa-home"></i></span>
            </a>
        </div>
        <div class="titles">
            <h3 class="title"><a href="https://zacharyloeber.com/">Zachary Loeber</a></h3>
            
                <span class="subtitle">The personal website of Zachary Loeber.</span>
            
        </div>

    

        
        <div class="toggler permanentTopNav">
        
            <i class="fa fa-bars" aria-hidden="true"></i>
        </div>
    </div>
</header>


        <div class="main container">
            
     
    <div class="article-wrapper u-cf single">
        
            <a class="bubble" href="https://zacharyloeber.com/blog/2013/06/17/use-powershell-to-create-a-windows-service-dependency-diagrams/">
    <i class="fa fa-fw fa-pencil"></i>
</a>

<article class="default article">
    

    <div class="content">
    <h3><a href="https://zacharyloeber.com/blog/2013/06/17/use-powershell-to-create-a-windows-service-dependency-diagrams/">Use Powershell to Create a Windows Service Dependency Diagrams</a></h3>
    <div class="meta">
        
            
                <span class="date moment">2013-06-17</span>
            
        

        
            <span class="readingTime">3 min read</span>
        

        
            <span class="categories">
                
                    <a href="https://zacharyloeber.com/categories/microsoft">Microsoft</a>
                
                    <a href="https://zacharyloeber.com/categories/powershell">Powershell</a>
                
                    <a href="https://zacharyloeber.com/categories/security">Security</a>
                
                    <a href="https://zacharyloeber.com/categories/system-administration">System Administration</a>
                
            </span>
        

        
            <span class="author"><a href="https://zacharyloeber.com/author/zachary-loeber">Zachary Loeber</a></span>
        
    </div>

    
        <p>I use powershell with graphviz to generate color coded service dependency diagrams for windows services. Besides creating useful and beautiful diagrams for your environment, this will also provide some interesting functions for gathering remote service information with alternate credentials.</p>

<h2 id="description">Description</h2>

<p>It seems like I come across something begging for a solution every day in my industry. For instance, I was working on performing a full dependency relationship table for services across my infrastructure and I got to thinking how cool it would be to have the ability to quickly create dependency diagrams for the services running on a server. Not finding anything free or simple, I whipped up a quick powershell script with a recursive function to utilize the built in cmdlets and return services, their dependencies, the dependencies of the dependencies, and so on. I then hacked this data into a template file for graphviz’s dot.exe diagram generation tool.</p>

<p>This probably should have been good enough but I wanted to also be able to do the same across multiple servers using alternate admin credentials. I found myself unrolling the solution into several sub-functions when get-service simply wasn’t filling my needs. This lead me to a better understanding of wmi and powershell functions in general. The end results are the following functions:</p>

<p style="padding-left: 30px;">
  Get-RemoteService
</p>

<p style="padding-left: 30px;">
  Get-RemoteServiceDependency
</p>

<p style="padding-left: 30px;">
  Get-RemoteServiceDependencyTree
</p>

<p style="padding-left: 30px;">
  Get-RemoteRegistry (Not actually used in this script but included as a bonus!)
</p>

<p>To actually generate the diagrams you will need graphviz’s dot.exe executable which can be downloaded and installed <a href="http://graphviz.org/">here</a>. Or <a href="https://code.google.com/p/graph-viz-portable/downloads/list">here is a portable version</a> of the application you can try utilizing. All you need is for the dot.exe file to work correctly to generate your diagrams though. You may have to modify this script to use the appropriate path to the executable if you use the portable version of graphviz.</p>

<h2 id="version">Version</h2>

<p>Version         :   1.0.0 June 16th 2013</p>

<p>&#8211; First release</p>

<h2 id="notes">Notes</h2>

<p>I included several functions in this exercise but I didn’t create any separate functions for the actual dot file generation. This is largely because there are so many ways this can be done. By default this script will create dependency diagrams which include hidden services in the dependency tree (as dashed nodes). This will also color code the nodes based on the status of the service.</p>

<p>The primary function you will use to create the dependency tree is the Get-RemoteServiceDependencyTree function. Here are three examples on how you might generate this data.</p>

<pre># Example 1: Get the netlogon service locally 
$servicetree = @(Get-RemoteServiceDependencyTree -Name 'netlogon' -IsRootService $true)</pre>

<pre># Example 2: Get the netlogon service on the remote 'server1' prompting for credentials before connecting 
$servicetree = @(Get-RemoteServiceDependencyTree -Name 'netlogon' -IsRootService $true -ComputerName 'server1' -PromptForCredential)</pre>

<pre># Example 3: Get any service with "Exchange" in the name on a remote server called 'server1' 
$Cred = Get-Credential 
$servicetree = @(get-remoteservice -IncludeDriverServices $true -Credential $Cred -ComputerName 'server1' | where {$_.Name -like "*exchange*"} | Get-RemoteServiceDependencyTree -IsRootService $true -Credential $Cred -ComputerName 'server1')</pre>

<pre># This removes possible duplicate node connections and should be done for all examples 
$servicetree = $servicetree | Sort-Object ID –Unique</pre>

<h2 id="screenshots">Screenshots</h2>

<p>Here is a diagram generated for the netlogon service (remotely to a test DC of mine for what it is worth).</p>

<p><a href="https://zacharyloeber.com/wp-content/uploads/2013/06/clip_image0021.jpg"><img style="margin: 0px; display: inline; background-image: none;" title="clip_image002[1]" alt="clip_image002[1]" src="https://zacharyloeber.com/wp-content/uploads/2013/06/clip_image0021_thumb.jpg?resize=244%2C78" width="244" height="78" border="0" data-recalc-dims="1" /></a></p>

<p>Here is a more complex diagram depicting all of the services with “exchange” in the name on an exchange 2010 mailbox.</p>

<p><a href="wp-content/uploads/2013/06/clip_image0041.jpg"><img style="margin: 5px; display: inline; background-image: none;" title="clip_image004[1]" alt="clip_image004[1]" src="https://zacharyloeber.com/wp-content/uploads/2013/06/clip_image0041_thumb.jpg?resize=244%2C147" width="244" height="147" border="0" data-recalc-dims="1" /></a></p>

<h2 id="conclusion">Conclusion</h2>

<p>This may be a good starting point for documentation of some of the essentials services running on your servers. Or if you are simply interested in to flow of service dependencies and need a good visual to understand them on your servers, this should certainly help you out.</p>

<h2 id="downloads">Downloads</h2>

<p><a href="http://gallery.technet.microsoft.com/Use-Powershell-to-Create-a-ca883479">Download the script from the technet gallery (more frequently updated)</a></p>

<p><a href="http://gallery.technet.microsoft.com/Use-Powershell-to-Create-a-ca883479">Download the script from this site (less frequently updated)</a></p>
    
</div>

    
<div class="footer">


    
        <div class="tags">
            <i class="fa fa-tags"></i>
            <div class="links">
                
                    <a href="https://zacharyloeber.com/tags/microsoft">Microsoft</a>
                
                    <a href="https://zacharyloeber.com/tags/network-administration">network administration</a>
                
                    <a href="https://zacharyloeber.com/tags/powershell">Powershell</a>
                
                    <a href="https://zacharyloeber.com/tags/scripting">Scripting</a>
                
                    <a href="https://zacharyloeber.com/tags/sysadmin">Sysadmin</a>
                
                    <a href="https://zacharyloeber.com/tags/system-administration">System Administration</a>
                
            </div>
        </div>
    

    
</div>

</article>

        
    </div>

    
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "zacharyloeber-com" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    

     

        </div>

        
<footer>
    <div class="container">

        
        <div class="recent-posts">
            <strong>Latest posts</strong>
                <ul>
                
                    <li>
                        <a href="https://zacharyloeber.com/blog/2018/12/10/devops-tool-of-the-day-syncthing/">Devops: Tool of the day – Syncthing</a>
                    </li>
                
                    <li>
                        <a href="https://zacharyloeber.com/blog/2018/09/28/devops-automating-kubernetes-deployments/">DevOps – Automating Kubernetes Deployments</a>
                    </li>
                
                    <li>
                        <a href="https://zacharyloeber.com/blog/2018/05/02/powershell-to-python-notes-from-the-field/">Powershell To Python Notes From The Field</a>
                    </li>
                
                </ul>
        </div>
        

        
        <div class="categories">
            <a href="https://zacharyloeber.com/categories/"><strong>Categories</strong></a>
                <ul>
                
                    <li>
                        <a href="https://zacharyloeber.com/categories/system-administration">System administration (130)</a>
                    </li>
                
                    <li>
                        <a href="https://zacharyloeber.com/categories/microsoft">Microsoft (120)</a>
                    </li>
                
                    <li>
                        <a href="https://zacharyloeber.com/categories/powershell">Powershell (106)</a>
                    </li>
                
                    <li>
                        <a href="https://zacharyloeber.com/categories/networking">Networking (52)</a>
                    </li>
                
                    <li>
                        <a href="https://zacharyloeber.com/categories/active-directory">Active directory (44)</a>
                    </li>
                
            </ul>
        </div>
        

        <div class="right">
            
            <div class="external-profiles">
                <strong>Social media</strong>

                
                
                    <a href="https://twitter.com/zloeber" target="_blank"><i class="fa fa-twitter-adblock-proof"></i></a>
                
                
                
                
                
                
                
                
                
                    <a href="https://github.com/zloeber" target="_blank"><i class="fa fa-github"></i></a>
                
                
            </div>
            

            
        </div>
    </div>
</footer>


<div class="credits">
    <div class="container">
        <div class="copyright">
            <a href="https://github.com/zloeber" target="_blank">
                &copy;
                
                    2019
                
                by Zachary Loeber
            </a>
	    
        </div>
        <div class="author">
            <a href="https://github.com/Lednerb/bilberry-hugo-theme" target="_blank">Bilberry Hugo Theme</a>
        </div>
    </div>
</div>


        

        

        
        
        <script type="text/javascript" src="https://zacharyloeber.com/js/externalDependencies.39c47e10e241eae2947b3fe21809c572.js" integrity="md5-OcR&#43;EOJB6uKUez/iGAnFcg=="></script>

        
        
        <script type="text/javascript" src="https://zacharyloeber.com/js/theme.ff50ae6dc1bfc220b23bf69dbb41b54e.js" integrity="md5-/1CubcG/wiCyO/adu0G1Tg=="></script>

        <script>
            $(".moment").each(function() {
                $(this).text(
                    moment( $(this).text() )
                        .locale( "en" )
                        .format('LL')
                );
            });

            $(".footnote-return sup").html("");
        </script>

        
            
        

        


    </body>
</html>
