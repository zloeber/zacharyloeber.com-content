<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content><meta name=description content><meta name=keywords content><meta name=generator content="Hugo 0.53"><title>Ubuntu Server 8.04 Post Install Tip #4: Setup SMART |</title><meta name=description content="Ubuntu Server 8.04 Post Install Tip #4: Setup SMART - %!s(&lt;nil&gt;)"><meta itemprop=name content="Ubuntu Server 8.04 Post Install Tip #4: Setup SMART"><meta itemprop=description content="Ubuntu Server 8.04 Post Install Tip #4: Setup SMART - %!s(&lt;nil&gt;)"><meta property=og:title content="Ubuntu Server 8.04 Post Install Tip #4: Setup SMART"><meta property=og:description content="Ubuntu Server 8.04 Post Install Tip #4: Setup SMART - %!s(&lt;nil&gt;)"><meta property=og:image content="https://www.gravatar.com/avatar/d41d8cd98f00b204e9800998ecf8427e?size=200"><meta property=og:url content=https://zacharyloeber.com/blog/2008/07/11/ubuntu-server-804-post-install-tip-4-setup-smart/><meta property=og:site_name content><meta property=og:type content=article><link rel=icon type=image/png href=https://zacharyloeber.com/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://zacharyloeber.com/favicon-16x16.png sizes=16x16><link rel=stylesheet href=/sass/combined.min.5aca3dc995ccd40fd537c60ccb5ce5882145ec5d4c4827c15f277667981cc0de.css></head><body class=bilberry-hugo-theme><nav><div class=container><ul class=topnav><li><a href=https://github.com/zloeber target=_blank>Github</a></li><li><a href=/page/about/>About</a></li><li><a href=/page/about-me/>About Me</a></li></ul></div></nav><header><div class=container><div class=logo><a href=/ class=logo><img src="https://www.gravatar.com/avatar/d41d8cd98f00b204e9800998ecf8427e?d=mm&size=200" alt>
<span class=overlay><i class="fa fa-home"></i></span></a></div><div class=titles><h3 class=title><a href=/>My cool new blog</a></h3></div><div class=toggler><i class="fa fa-bars" aria-hidden=true></i></div></div></header><div class="main container"><div class="article-wrapper u-cf single"><a class=bubble href=/blog/2008/07/11/ubuntu-server-804-post-install-tip-4-setup-smart/><i class="fa fa-fw fa-pencil"></i></a><article class="default article"><div class=content><h3><a href=/blog/2008/07/11/ubuntu-server-804-post-install-tip-4-setup-smart/>Ubuntu Server 8.04 Post Install Tip #4: Setup SMART</a></h3><div class=meta><span class="date moment">2008-07-11</span>
<span class=categories><a href=/categories/linux>Linux</a>
<a href=/categories/ubuntu>Ubuntu</a></span>
<span class=author><a href=/author/zachary-loeber>Zachary Loeber</a></span></div><p>Setup SMART Disk Monitoring</p><p>If your disk is going bad no one going to tell you about it until you start hearing it. And if you start hearing issues with your drive it may be too late to backup your data or do anything else you need to do to not be driveless. I&#8217;m uncertain why some of this is not available as an install option for more distros but a good warning before the storm can save your data and your sanity.</p><p>Smart disk monitoring is a built in function on most modern hard drives that will auto detect errors and other issues. The thing is that the drive has this information but you need to setup and install some tools to read it, otherwise smart disk monitoring may be happening regularlly for nothing. What a waste that would be! ðŸ™‚</p><p>Start by installing it:</p><p><code>sudo apt-get install smartmontools</code></p><p>First find out which drives you are using:</p><p><code>mount&lt;br /&gt;
&lt;strong&gt;/dev/sda1 on /&lt;/strong&gt; type ext3 (rw,errors=remount-ro)&lt;br /&gt;
proc on /proc type proc (rw,noexec,nosuid,nodev)&lt;br /&gt;
/sys on /sys type sysfs (rw,noexec,nosuid,nodev)&lt;br /&gt;
varrun on /var/run type tmpfs (rw,noexec,nosuid,nodev,mode=0755)&lt;br /&gt;
varlock on /var/lock type tmpfs (rw,noexec,nosuid,nodev,mode=1777)&lt;br /&gt;
udev on /dev type tmpfs (rw,mode=0755)&lt;br /&gt;
devshm on /dev/shm type tmpfs (rw)&lt;br /&gt;
devpts on /dev/pts type devpts (rw,gid=5,mode=620)&lt;br /&gt;
securityfs on /sys/kernel/security type securityfs (rw)</code></p><p>This displays all mounted media, look for /dev/sda# or /dev/hda1#. Where # is a letter of a partition and the sda/hda portion is the reference to the drive. This can be sdb,sdc,hdb,hdc, et cetera depending on how many drives you have. The sd drives are Sata, the hd drives are Pata. I&#8217;ll be monitoring my sata drive or sda</p><p>Now see if the devices are SMART capable by running this for each device we will monitor:</p><p><code>sudo smartctl -a /dev/sda | grep &quot;SMART support&quot;&lt;br /&gt;
SMART support is: Available - device has SMART capability.&lt;br /&gt;
SMART support is: Enabled</code></p><p>Ok, we have the support we need so lets enable the daemon (this must be done in the following config file else the daemon will not start even if enabled at startup.</p><p>`sudo nano /etc/default/smartmontools<br></p><h1 id=uncomment-to-start-smartd-on-system-startup-br>uncomment to start smartd on system startup<br></h1><p>start_smartd=yes`</p><p>Now change the monitoring options by commenting out the auto detection and adding in your own as well as your options. For the type of disk (after the -d) you can find some excellent examples from the smartd.conf manual. A quick list though:</p><p>-d type where type is:</p><p>ata &#8211; Basic or older pata drive</p><p>scsi &#8211; scsi drive, maybe on a server</p><p>sat &#8211; sata drive or any one acting like sata so: /sda, /sdb, /sdc, et cetera</p><p>marvell &#8211; marvell chip-set based drive controllers</p><p>3ware,N &#8211; 3ware chip-set based RAID controller (N=drive in array to be monitored)</p><p>hpt,L/M/N = Highpoint RocketRAID controller (L=controller id/M=channel/N=pmport if available)</p><p>cciss,N = cciss RAID controller (N=drive in array to be monitored)</p><p>removable = if the drive is not there when starting continue loading smartd instead of exiting</p><p>Here are some other options we will use as well</p><p>-n standby,q</p><p>Force disks not to spin up and check status when being checked if the disk is in standby or sleep, the q supresses informational logging which would spin up the disk as well</p><p>-H</p><p>Check health status of disk</p><p>-l error -l selftest</p><p>Check SMART log for errors and selftest errors (check if it has increased since the last check)</p><p>-s (O/../../5/11|L/../../5/13|C/../../5/15)</p><p>Run self tests at regular intervals. This is different than the basic autmatic polling that occurs every 30 minutes. The regex statements mean</p><p>O = offline intermediate checks (ATA only) on the 5th day of the week at 11</p><p>L = long test on the 5th day of the week at hour 13 (2pm)</p><p>C = Conveyance self test (ATA only) on the 5th day of the week at hour 15 (3pm)</p><p>-m root -M exec /usr/local/bin/smartd.sh</p><p>Send an e-mail to root and then execute smartd.sh</p><p>So edit your smartd.conf already:</p><p><code>sudo nano /etc/smartd.conf</code></p><p>Now change the following:</p><pre><code># The word DEVICESCAN will cause any remaining lines in this
# configuration file to be ignored: it tells smartd to scan for all
# ATA and SCSI devices.  DEVICESCAN may be followed by any of the
# Directives listed below, which will be applied to all devices that
# are found.  Most users should comment out DEVICESCAN and explicitly
# list the devices that they wish to monitor.
&lt;strong&gt;#DEVICESCAN -m root -M exec /usr/share/smartmontools/smartd-runner&lt;/strong&gt;
&lt;strong&gt;
#Add this at the end
# modify -d sat to be the type of drive you have per the examples in this file you are
# editing, in this example we are escaping each directive to have them all on separate
# lines for easier editing and reading
/dev/sda -d sat\
-H \
-l error -l selftest \
-n standby,q \
-s (O/../../5/11|L/../../5/13|C/../../5/15) \
-m root -M exec /usr/local/bin/smartd.sh&lt;/strong&gt;
</code></pre><p>If you are going to shutdown on error then create the smartd.sh file</p><p><code>sudo nano /usr/local/bin/smartd.sh</code></p><p>Add this and save:</p><p>`#!/bin/bash<br>LOGFILE=&ldquo;/var/log/smartd.log&rdquo;<br>echo -e &ldquo;$(date)\n$SMARTD_MESSAGE\n&rdquo; &gt;&gt; &ldquo;$LOGFILE&rdquo;<br>mail root &lt; $LOGFILE<br></p><h1 id=uncomment-to-shutdown-br>Uncomment to shutdown<br></h1><h1 id=sleep-40s-br>sleep 40s<br></h1><p>#shutdown -h now`</p><p>Make script executable</p><p><code>sudo chmod +x /usr/local/bin/smartd.sh</code></p><p>Start the service!</p><p><code>sudo /etc/init.d/smartmontools start</code></p><p>If you start getting errors and warnings take a look and see what may be wrong. You may just have to start getting your backups up to date.</p><p>A few quick commands for the road:</p><p>enable smart monitoring</p><p><code>sudo smartmon -S on /dev/sda1</code></p><p>Do a health check and look for PASSED</p><p><code>smartctl -Hc /dev/sda</code></p><p>take a peek at all logged errors (there should not be many if any at all). If there are a lot then start looking for either a new drive or a reason for the errors.</p><p><code>sudo smartmon -a /dev/sda1</code></p></div><div class="footer no-tags"></div></article></div><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"zacharyloeber-com"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><footer><div class=container><div class=recent-posts><strong>Latest posts</strong><ul><li><a href=/blog/2018/12/10/devops-tool-of-the-day-syncthing/>Devops: Tool of the day â€“ Syncthing</a></li><li><a href=/blog/2018/09/28/devops-automating-kubernetes-deployments/>DevOps â€“ Automating Kubernetes Deployments</a></li><li><a href=/blog/2018/05/02/powershell-to-python-notes-from-the-field/>Powershell To Python Notes From The Field</a></li><li><a href=/blog/2018/03/26/powershell-windows-subsystem-for-linux/>PowerShell: Windows Subsystem For Linux</a></li><li><a href=/blog/2018/02/24/email-reputation-and-design-a-condensed-guide/>Email Reputation and Design: A Condensed Guide</a></li><li><a href=/blog/2018/02/04/powershell-azuread-dynamic-groups/>PowerShell: AzureAD Dynamic Groups</a></li><li><a href=/blog/2018/01/10/powershell-office-365-group-based-licencing-cleanup/>PowerShell: Office 365 Group Based Licencing Cleanup</a></li></ul></div><div class=categories><a href=/categories/><strong>Categories</strong></a><ul><li><a href=/categories/system-administration>System administration (130)</a></li><li><a href=/categories/microsoft>Microsoft (120)</a></li><li><a href=/categories/powershell>Powershell (106)</a></li><li><a href=/categories/networking>Networking (52)</a></li><li><a href=/categories/active-directory>Active directory (44)</a></li><li><a href=/categories/exchange>Exchange (38)</a></li><li><a href=/categories/exchange-2010>Exchange 2010 (38)</a></li></ul></div><div class=right><div class=external-profiles><strong>Social media</strong></div></div></div></footer><div class=credits><div class=container><div class=copyright><a href=https://github.com/Lednerb target=_blank>&copy;
2018
by Lednerb</a></div><div class=author><a href=https://github.com/Lednerb/bilberry-hugo-theme target=_blank>Bilberry Hugo Theme</a></div></div></div><script type=text/javascript src=/js/externalDependencies.39c47e10e241eae2947b3fe21809c572.js integrity="md5-OcR&#43;EOJB6uKUez/iGAnFcg=="></script><script type=text/javascript src=/js/theme.ff50ae6dc1bfc220b23bf69dbb41b54e.js integrity="md5-/1CubcG/wiCyO/adu0G1Tg=="></script><script>$(".moment").each(function(){$(this).text(moment($(this).text()).locale("en").format('LL'));});$(".footnote-return sup").html("");</script></body></html>