<!doctype html>
<html class="no-js" lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="author" content="Zachary Loeber">
        <meta name="description" content="Zachary Loeber&#39;s Personal Site">
        <meta name="keywords" content="blog,personal,devops,infrastructure,code">
        <meta name="generator" content="Hugo 0.53" />
        <title> Powershell Tip: Save and Load Calculated Property Definitions | Zachary Loeber</title>
        <meta name="description" content="Powershell Tip: Save and Load Calculated Property Definitions - Zachary Loeber&#39;s Personal Site">
        <meta itemprop="name" content="Powershell Tip: Save and Load Calculated Property Definitions">
        <meta itemprop="description" content="Powershell Tip: Save and Load Calculated Property Definitions - Zachary Loeber&#39;s Personal Site">
        <meta property="og:title" content="Powershell Tip: Save and Load Calculated Property Definitions">
        <meta property="og:description" content="Powershell Tip: Save and Load Calculated Property Definitions - Zachary Loeber&#39;s Personal Site">
        <meta property="og:image" content="https://www.gravatar.com/avatar/48fc6231ab6cad25f101a82e5932d9dd?size=200">
        <meta property="og:url" content="https://zacharyloeber.com/blog/2014/02/09/powershell-tip-save-and-load-calculated-property-definitions/">
        <meta property="og:site_name" content="Zachary Loeber">
        <meta property="og:type" content="article">
        <link rel="icon" type="image/png" href="https://zacharyloeber.com/favicon-32x32.png" sizes="32x32">
        <link rel="icon" type="image/png" href="https://zacharyloeber.com/favicon-16x16.png" sizes="16x16">

	

        
        
        
        
        <link rel="stylesheet" href="/sass/combined.min.5f50be91a665634f9dfed5900bc388393fc430e3369d58e73b8375457a6df832.css">

        

        
            
        
    </head>
    <body class="bilberry-hugo-theme">
        
<nav class="permanentTopNav">

    <div class="container">
        <ul class="topnav">
            
                
                    <li><a href="/" target="">Home</a></li>
                
            
                
                    <li><a href="/page/about/">About</a></li>
                
            
                
                    <li><a href="/page/about-me/">About Me</a></li>
                
            
                
                    <li><a href="https://github.com/zloeber" target="_blank">Github</a></li>
                
            
        </ul>

        
    </div>
</nav>


        <header>
    <div class="container">
        <div class="logo">
            <a href="/" class="logo">
                
                    <img src="https://www.gravatar.com/avatar/48fc6231ab6cad25f101a82e5932d9dd?d=mm&size=200" alt="">
                

                <span class="overlay"><i class="fa fa-home"></i></span>
            </a>
        </div>
        <div class="titles">
            <h3 class="title"><a href="/">Zachary Loeber</a></h3>
            
                <span class="subtitle">The personal website of Zachary Loeber.</span>
            
        </div>

    

        
        <div class="toggler permanentTopNav">
        
            <i class="fa fa-bars" aria-hidden="true"></i>
        </div>
    </div>
</header>


        <div class="main container">
            
     
    <div class="article-wrapper u-cf single">
        
            <a class="bubble" href="/blog/2014/02/09/powershell-tip-save-and-load-calculated-property-definitions/">
    <i class="fa fa-fw fa-pencil"></i>
</a>

<article class="default article">
    

    <div class="content">
    <h3><a href="/blog/2014/02/09/powershell-tip-save-and-load-calculated-property-definitions/">Powershell Tip: Save and Load Calculated Property Definitions</a></h3>
    <div class="meta">
        
            
                <span class="date moment">2014-02-10</span>
            
        

        
            <span class="readingTime">4 min read</span>
        

        
            <span class="categories">
                
                    <a href="/categories/microsoft">Microsoft</a>
                
                    <a href="/categories/powershell">Powershell</a>
                
                    <a href="/categories/system-administration">System Administration</a>
                
            </span>
        

        
            <span class="author"><a href="/author/zachary-loeber">Zachary Loeber</a></span>
        
    </div>

    
        <p>Using Export-CliXML and Import-CliXML (as well as some custom code) you can save calculated properties in a file for later use. Although the need for something like this is rather infrequent the exercise can better familiarize you with multiple Powershell techniques and concepts.</p>

<h3 id="intro">Intro</h3>

<p>I’ve picked up quite a bit of PowerShell know how over the course of the last few years. I’m going to try and round back to some of the more interesting tricks I’ve picked up and share them in a series of quick tip articles.&nbsp; This first one I recently discovered as a method to store, then later load, <a href="http://technet.microsoft.com/en-us/library/ff730948.aspx">calculated property</a> definitions.</p>

<p>Why would I want to do this? Well a few of my recent projects have involved gathering a large amount of data from either computers or AD and then regurgitating the data into one of several reports. So the same data element may be split by a carriage return for an excel report or a <br /> for an html report (as a small example). In order to accommodate this functionality I chose to bundle in all the report element output in one big hash which also includes the report section data and several other bits of logic.</p>

<p>Here is an example of one report section where the same data is used for two different types of reports.</p>

<pre>$Report = @{
  'ReportTypes' = @{
       'ExcelExport' = @{ 
         'ContainerType' = 'Full' 
         'SectionOverride' = $false 
         'TableType' = 'Horizontal' 
         'Properties' = 
              @{n='Name';e={$_.virtualserver}}, 
              @{n='Address';e={$_.address}}, 
              @{n='Port';e={$_.port}}, 
              @{n='Pool';e={$_.pool}}, 
              @{n='Enabled';e={$_.enabled}}, 
              @{n='Availability';e={$_.availability}}, 
              @{n='Persistence Profile';e={[string]$_.persistenceprofile -replace ' ', "`n`r"}}, 
              @{n='Rules';e={[string]$_.rules -replace ' ', "`n`r"}} 
       } 
       'FullDocumentation' = @{ 
          'ContainerType' = 'Full' 
          'SectionOverride' = $false 
          'TableType' = 'Horizontal' 
          'Properties' = 
              @{n='Name';e={'&lt;a id="{0}"&gt;{0}&lt;/a&gt;' -f $_.virtualserver}}, 
              @{n='Persistence Profile';e={[string]$_.persistenceprofile -replace ' ', "&lt;br /&gt;`n`r"}}, 
              @{n='Rules';e={[string]$_.rules -replace ' ', "&lt;br /&gt;`n`r"}} 
        } 
   }
}</pre>

<p>Later on I select the report section data using the calculated properties for the report I want to create like this:</p>

<pre>$SectionData = $ReportData | Select $Report[‘ReportType’][‘FullDocumentation’][‘Properties’]</pre>

<h3 id="calculated-properties">Calculated Properties</h3>

<p>Calculated properties are simply two element hashes with a label and an expression (technically you only need the expression but that expression becomes the element label and that’s ugly). The label key can be &#8220;Name&#8221;,&#8221;Label&#8221;,&#8221;n&#8221;, or &#8220;l&#8221; and the value is a string. The expression key can be &#8220;Expression&#8221; or just &#8220;e&#8221; and its value is a scriptblock (so it must be surrounded by curly braces).</p>

<p>It should be noted that there is nothing special about calculated properties when you define them in separate variables. You are simply defining an array of hashes. In the example code above I could have also written the calculated properties like this:</p>

<pre>'Properties' = @(@{n='Name';e={'&lt;a id="{0}"&gt;{0}&lt;/a&gt;' -f $_.virtualserver}},
@{n='Persistence Profile';e={[string]$_.persistenceprofile -replace ' ', "&lt;br /&gt;`n`r"}},
@{n='Rules';e={[string]$_.rules -replace ' ', "&lt;br /&gt;`n`r"}})</pre>

<h3 id="getting-to-the-point">Getting To The Point</h3>

<p>Ok, so how do we save calculated property definitions into an external file? With most data exports that involve basic arrays or psobjects I’d use Export-CSV&nbsp; Whenever you are looking to save hash data into files your go to command will be Export-CliXML. Export-CliXML will export hash information into an XML format which represents the hash for an almost perfect re-import with Import-CliXML.</p>

<p>Notice I said, “almost perfect”. Export-CliXML is not going to recognize the expression as the scriptblock it is meant to be. Instead it will save it as a plain string. When you re-import the calculated properties you need to convert all the expressions back to a scriptblock otherwise when you use them you will simply get empty results. Here is the example code I put together which shows the top 5 memory consuming processes and the percentage they are utilizing. I create a separate variable which holds the calculated properties, export it to a save file, then import the file into a different variable, update each expression in the resulting array of hashes to be scriptblocks, and then finish by using the resulting variable.</p>

<pre>$SaveFile = 'C:\Temp\saveprops.xml' 
$TotalMem = (Get-WMIObject -class 'Win32_ComputerSystem').TotalPhysicalMemory 
$MemUsageProp = @{n='Name';e={$_.ProcessName}}, 
@{n='MemoryUsage';e={[math]::Round((($_.WS/$TotalMem)*100),2)}}
Export-Clixml -InputObject $MemUsageProp -Path $SaveFile
$MemUsageProp2 = Import-Clixml -Path $SaveFile
$MemUsageProp2 | ForEach { 
   $_['e'] = [Scriptblock]::Create($_['e']) 
}
Get-Process | 
  Sort-Object -Property WS -Descending&nbsp;| 
  Select-Object $MemUsageProp2 -First 5</pre>

<p>This is a pretty simple example but if we were embedding the calculated properties with several other elements you would have to customize this to fit your needs. Also notice that I only target the &#8216;e&#8217; element for converting into a scriptblock. It should be a nominal effort to update this to include the &#8216;expression&#8217; element as well.</p>
    
</div>

    
<div class="footer">


    
        <div class="tags">
            <i class="fa fa-tags"></i>
            <div class="links">
                
                    <a href="/tags/calculated-properties">Calculated Properties</a>
                
                    <a href="/tags/export-clixml">Export-CliXML</a>
                
                    <a href="/tags/import-clixml">Import-CliXML</a>
                
                    <a href="/tags/powershell">Powershell</a>
                
                    <a href="/tags/psc">PSC</a>
                
            </div>
        </div>
    

    
</div>

</article>

        
    </div>

    
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "zacharyloeber-com" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    

     

        </div>

        
<footer>
    <div class="container">

        
        <div class="recent-posts">
            <strong>Latest posts</strong>
                <ul>
                
                    <li>
                        <a href="/blog/2018/12/10/devops-tool-of-the-day-syncthing/">Devops: Tool of the day – Syncthing</a>
                    </li>
                
                    <li>
                        <a href="/blog/2018/09/28/devops-automating-kubernetes-deployments/">DevOps – Automating Kubernetes Deployments</a>
                    </li>
                
                    <li>
                        <a href="/blog/2018/05/02/powershell-to-python-notes-from-the-field/">Powershell To Python Notes From The Field</a>
                    </li>
                
                </ul>
        </div>
        

        
        <div class="categories">
            <a href="/categories/"><strong>Categories</strong></a>
                <ul>
                
                    <li>
                        <a href="/categories/system-administration">System administration (130)</a>
                    </li>
                
                    <li>
                        <a href="/categories/microsoft">Microsoft (120)</a>
                    </li>
                
                    <li>
                        <a href="/categories/powershell">Powershell (106)</a>
                    </li>
                
                    <li>
                        <a href="/categories/networking">Networking (52)</a>
                    </li>
                
                    <li>
                        <a href="/categories/active-directory">Active directory (44)</a>
                    </li>
                
            </ul>
        </div>
        

        <div class="right">
            
            <div class="external-profiles">
                <strong>Social media</strong>

                
                
                    <a href="https://twitter.com/zloeber" target="_blank"><i class="fa fa-twitter-adblock-proof"></i></a>
                
                
                
                
                
                
                
                
                
                    <a href="https://github.com/zloeber" target="_blank"><i class="fa fa-github"></i></a>
                
                
            </div>
            

            
        </div>
    </div>
</footer>


<div class="credits">
    <div class="container">
        <div class="copyright">
            <a href="https://github.com/zloeber" target="_blank">
                &copy;
                
                    2019
                
                by Zachary Loeber
            </a>
	    
        </div>
        <div class="author">
            <a href="https://github.com/Lednerb/bilberry-hugo-theme" target="_blank">Bilberry Hugo Theme</a>
        </div>
    </div>
</div>


        

        

        
        
        <script type="text/javascript" src="/js/externalDependencies.39c47e10e241eae2947b3fe21809c572.js" integrity="md5-OcR&#43;EOJB6uKUez/iGAnFcg=="></script>

        
        
        <script type="text/javascript" src="/js/theme.ff50ae6dc1bfc220b23bf69dbb41b54e.js" integrity="md5-/1CubcG/wiCyO/adu0G1Tg=="></script>

        <script>
            $(".moment").each(function() {
                $(this).text(
                    moment( $(this).text() )
                        .locale( "en" )
                        .format('LL')
                );
            });

            $(".footnote-return sup").html("");
        </script>

        
            
        

        


    </body>
</html>
